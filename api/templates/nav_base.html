<nav class="fixed top-0 left-0 right-0 z-50 bg-black/20 backdrop-blur-md border-b border-white/10">
  <div class="max-w-7xl mx-auto px-4">
    <div class="flex items-center justify-between h-16 gap-2 md:gap-6">
      <!-- Logo and brand name -->
      <div class="flex items-center space-x-2 cursor-pointer flex-shrink-0" onclick="location.href='/'">
        <div class="w-8 h-8 rounded-lg flex items-center justify-center">
          <img src="{{ url_for('static', filename='images/logo.png') }}" alt="YumeAnime Logo" class="w-full h-full object-cover">
        </div>
        <span class="text-white font-bold text-xl hidden sm:block">YumeAnime</span>
        <!-- Show full website name on mobile instead of truncated "Yume" -->
        <span class="text-white font-bold text-sm sm:hidden">YumeAnime</span>
      </div>

      <!-- Include search functionality -->
      {% include 'search.html' %}

      <!-- Navigation actions (search button for mobile and login) -->
      <div class="flex items-center gap-3 flex-shrink-0">
        <!-- Search dropdown button - mobile only -->
        <div class="relative md:hidden">
          <button id="search-dropdown-toggle" class="p-2 text-white hover:bg-white/10 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-white/20" aria-label="Open search">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <circle cx="11" cy="11" r="8" stroke-width="2"></circle>
              <path d="m21 21-4.35-4.35" stroke-width="2" stroke-linecap="round"></path>
            </svg>
          </button>
        </div>

        <!-- Auth container -->
        <div id="auth-container">
          {% include 'loginWidget.html' %}
        </div>
      </div>
    </div>
  </div>
</nav>

<script>
    /**
     * Navigation Base Script
     * Handles login/logout functionality and integrates with search functionality
     */

    // Function to update the navbar UI based on a user object
    function updateNavbarUI(user) {
        const loginBtn = document.getElementById('loginBtn');
        const profileBox = document.getElementById('profileBox');
        const profileName = document.getElementById('profileName');
        const profileAvatar = document.getElementById('profileAvatar');
        const logoutBtn = document.getElementById('logoutBtn');

        if (user) {
            // User is logged in
            loginBtn?.classList.add('hidden');
            profileBox?.classList.remove('hidden');
            profileBox?.classList.add('flex');
            if (profileName) profileName.textContent = user.username;
            if (profileAvatar) {
                profileAvatar.src = user.avatar || profileAvatar.getAttribute('data-default');
            }
        } else {
            // User is logged out
            loginBtn?.classList.remove('hidden');
            profileBox?.classList.add('hidden');
            profileBox?.classList.remove('flex');
            if (profileAvatar) profileAvatar.src = profileAvatar.getAttribute('data-default');
        }
    }
    
    // Make the update function available to the loginWidget.js
    window.updateNavbarUI = updateNavbarUI;

    // DOM Content Loaded Event Handler
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize login functionality
        initializeLoginFunctionality();
    });

    /**
     * Initialize login-related functionality
     */
    function initializeLoginFunctionality() {
        // Check for saved login on page load
        if (window.loginWidget && window.loginWidget.isUserLoggedIn()) {
            const user = window.loginWidget.getUser();
            updateNavbarUI(user);
        }

        // Event listener for the main login button
        document.getElementById('loginBtn')?.addEventListener('click', () => {
            if (window.loginWidget) {
                window.loginWidget.login();
            }
        });

        // Event listener for the main logout button
        document.getElementById('logoutBtn')?.addEventListener('click', () => {
            if (window.loginWidget) {
                window.loginWidget.logout();
            }
        });
    }
</script>

<!-- Include search JavaScript functionality -->
<script src="{{ url_for('static', filename='js/search.js') }}"></script>
