<!-- Server and Language Selector Component -->
<div class="mb-8 md:mb-10">
    <div class="bg-gradient-to-br from-gray-900/50 to-gray-800/30 backdrop-blur-sm border border-gray-700/50 rounded-2xl p-4 md:p-6 shadow-xl">
        <div class="flex flex-col lg:flex-row items-start lg:items-center justify-between gap-6">
            <!-- Server Selector -->
            <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4 w-full lg:w-auto">
                <!-- Improved server selector with better layout and styling -->
                <label class="text-gray-400 font-semibold text-sm uppercase tracking-wider whitespace-nowrap">Server</label>
                <div class="flex flex-wrap gap-2 md:gap-3 w-full sm:w-auto" id="serverSelector">
                    {% if available_servers %}
                        {# Render hd-2 and hd-1 first in explicit order #}
                        {% set server_order = ['hd-2', 'hd-1'] %}
                        {% for server_name in server_order %}
                            {% set server = available_servers | selectattr("serverName", "equalto", server_name) | first %}
                            {% if server %}
                                <button
                                    data-server="{{ server.serverName }}"
                                    class="server-btn px-4 md:px-5 py-2 md:py-2.5 rounded-xl font-semibold transition-all duration-300 text-sm shadow-lg {% if server.serverName == selected_server %}bg-gradient-to-r from-purple-500 to-purple-600 text-white ring-2 ring-purple-400/50 ring-offset-2 ring-offset-gray-900 scale-105{% else %}bg-gray-800 border-2 border-gray-600 text-gray-300 hover:border-purple-500 hover:bg-gray-700 hover:scale-105{% endif %}"
                                    onclick="switchServer('{{ server.serverName }}')">
                                    {% if server.serverName == 'hd-2' %}HD-1{% elif server.serverName == 'hd-1' %}HD-2{% else %}{{ server.serverName[:8].upper() }}{% endif %}
                                </button>
                            {% endif %}
                        {% endfor %}

                        {# Render remaining servers in original order #}
                        {% for server in available_servers %}
                            {% if server.serverName not in server_order %}
                                <button
                                    data-server="{{ server.serverName }}"
                                    class="server-btn px-4 md:px-5 py-2 md:py-2.5 rounded-xl font-semibold transition-all duration-300 text-sm shadow-lg {% if server.serverName == selected_server %}bg-gradient-to-r from-purple-500 to-purple-600 text-white ring-2 ring-purple-400/50 ring-offset-2 ring-offset-gray-900 scale-105{% else %}bg-gray-800 border-2 border-gray-600 text-gray-300 hover:border-purple-500 hover:bg-gray-700 hover:scale-105{% endif %}"
                                    onclick="switchServer('{{ server.serverName }}')">
                                    {{ server.serverName[:8].upper() }}
                                </button>
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        <button
                            data-server="hd-2"
                            class="server-btn px-4 md:px-5 py-2 md:py-2.5 rounded-xl font-semibold bg-gradient-to-r from-purple-500 to-purple-600 text-white ring-2 ring-purple-400/50 ring-offset-2 ring-offset-gray-900 transition-all duration-300 text-sm shadow-lg scale-105"
                            onclick="switchServer('hd-2')">
                            HD-1
                        </button>
                    {% endif %}
                </div>
            </div>

            {% if dub_available %}
            <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4 w-full lg:w-auto lg:border-l lg:border-gray-700/50 lg:pl-6">
                <!-- Improved language selector styling -->
                <label class="text-gray-400 font-semibold text-sm uppercase tracking-wider whitespace-nowrap">Audio</label>
                <div class="flex gap-2 md:gap-3 language-toggle w-full sm:w-auto">
                    {% if sub_url %}
                    <a href="{{ sub_url }}"
                       class="language-btn px-4 md:px-5 py-2 md:py-2.5 rounded-xl font-semibold transition-all duration-300 text-sm flex-1 sm:flex-none text-center shadow-lg {% if lang == 'sub' %}bg-gradient-to-r from-purple-500 to-purple-600 text-white ring-2 ring-purple-400/50 ring-offset-2 ring-offset-gray-900 scale-105 active{% else %}bg-gray-800 border-2 border-gray-600 text-gray-300 hover:border-purple-500 hover:bg-gray-700 hover:scale-105{% endif %}">
                        SUB
                    </a>
                    {% endif %}
                    {% if dub_url %}
                    <a href="{{ dub_url }}"
                       class="language-btn px-4 md:px-5 py-2 md:py-2.5 rounded-xl font-semibold transition-all duration-300 text-sm flex-1 sm:flex-none text-center shadow-lg {% if lang == 'dub' %}bg-gradient-to-r from-purple-500 to-purple-600 text-white ring-2 ring-purple-400/50 ring-offset-2 ring-offset-gray-900 scale-105 active{% else %}bg-gray-800 border-2 border-gray-600 text-gray-300 hover:border-purple-500 hover:bg-gray-700 hover:scale-105{% endif %}">
                        DUB
                    </a>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
function switchServer(serverName) {
    localStorage.setItem('yumePreferredServer', serverName);
    document.cookie = `preferred_server=${serverName}; path=/; max-age=31536000`;

    fetch('/api/set-server', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ server: serverName })
    }).then(() => {
        console.log('[v0] Server preference saved:', serverName);
        window.location.reload();
    }).catch(err => {
        console.error('[v0] Failed to sync server:', err);
        window.location.reload();
    });
}
</script>
